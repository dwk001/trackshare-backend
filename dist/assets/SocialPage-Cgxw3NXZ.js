import{u as e,j as a,c as s,L as r}from"./index-BDwg7ODs.js";import{r as t}from"./vendor-KIEtaiwe.js";import{u as i,b as n,c as l}from"./query-Y2oWywPX.js";import{a as d}from"./apiService-Di-AlgiQ.js";import{m as c,T as o,U as x,l as m,n as p,H as h,p as g,j as y,P as u,E as j,S as b,q as f,r as N,X as v,s as k}from"./ui-C7EfP91I.js";import"./router-mjhA_Ms8.js";import"./utils-CrFdsnXa.js";const w=[{id:"trending",label:"Trending",icon:o,public:!0},{id:"friends",label:"Friends",icon:x,public:!1}];function S({className:x}){const[b,f]=t.useState("trending"),[N,v]=t.useState(!1),[k,S]=t.useState(""),[F,T]=t.useState("all"),_=i(),{isAuthenticated:Q}=e(),{data:q,isLoading:L,error:P,refetch:A}=n(["posts",b],()=>d.getPosts({feedType:b}),{staleTime:12e4,cacheTime:3e5}),M=l(e=>d.likePost(e),{onSuccess:()=>{_.invalidateQueries(["posts",b])}}),z=l(e=>d.sharePost(e),{onSuccess:()=>{_.invalidateQueries(["posts",b])}}),D=q?.data||[],I=q?.pagination?.has_more||!1,R=e=>{const a=new Date,s=new Date(e),r=Math.floor((a.getTime()-s.getTime())/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:r<2592e3?`${Math.floor(r/86400)}d ago`:s.toLocaleDateString()},U=e=>"track"===e.type?a.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsxs("div",{className:"relative flex-shrink-0",children:[a.jsx("img",{src:e.track?.artwork||e.track?.artworkMedium||"/placeholder-music.jpg",alt:e.track?.title,className:"w-16 h-16 rounded-lg object-cover",loading:"lazy"}),a.jsx("button",{onClick:()=>{e.track},className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-30 rounded-lg flex items-center justify-center transition-all duration-300",children:a.jsx(u,{className:"w-6 h-6 text-white opacity-0 hover:opacity-100 transition-opacity"})})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.track?.title}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm truncate",children:e.track?.artist}),e.track?.album&&a.jsx("p",{className:"text-gray-500 dark:text-gray-500 text-xs truncate",children:e.track.album}),a.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[a.jsxs("button",{onClick:()=>{e.track},className:"flex items-center space-x-1 text-primary-500 hover:text-primary-600 transition-colors",children:[a.jsx(u,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Play"})]}),a.jsxs("button",{className:"flex items-center space-x-1 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition-colors",children:[a.jsx(j,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Open"})]})]})]})]})}):"playlist"===e.type?a.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"relative flex-shrink-0",children:a.jsx("img",{src:e.playlist?.coverImage||"/placeholder-playlist.jpg",alt:e.playlist?.name,className:"w-16 h-16 rounded-lg object-cover",loading:"lazy"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:e.playlist?.name}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:[e.playlist?.trackCount," tracks"]}),a.jsx("p",{className:"text-gray-500 dark:text-gray-500 text-xs truncate",children:e.playlist?.description})]})]})}):null;return a.jsx("div",{className:s("min-h-screen bg-gray-50 dark:bg-gray-900",x),children:a.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[a.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Social Feed"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Discover what your friends are listening to and share your musical journey."})]}),a.jsx(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm mb-6",children:a.jsx("div",{className:"flex overflow-x-auto",children:w.map(e=>{const r=e.icon;return a.jsxs("button",{onClick:()=>{return a=e.id,void f(a);var a},className:s("flex items-center space-x-2 px-6 py-4 text-sm font-medium border-b-2 transition-colors whitespace-nowrap",b===e.id?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[a.jsx(r,{className:"w-4 h-4"}),a.jsx("span",{children:e.label})]},e.id)})})}),"friends"===b&&Q&&a.jsx(C,{friendTab:F,setFriendTab:T,friendSearchQuery:k,setFriendSearchQuery:S}),"trending"===b&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"space-y-6",children:L?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx(r,{size:"lg"})}):P?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-red-500 mb-4",children:"Failed to load posts"}),a.jsx("button",{onClick:()=>A(),className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Try Again"})]}):0===D.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4",children:a.jsx(o,{className:"w-8 h-8 text-gray-400"})}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No posts found. Be the first to share something!"})]}):a.jsx(m,{children:D.map((e,r)=>a.jsxs(c.article,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.05*r},className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 pb-4",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("img",{src:e.user?.avatar||"/placeholder-avatar.jpg",alt:e.user?.displayName,className:"w-10 h-10 rounded-full object-cover",loading:"lazy"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.user?.displayName}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:R(e.createdAt)})]})]}),a.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:a.jsx(p,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"px-6 pb-4",children:[e.content&&a.jsx("p",{className:"text-gray-900 dark:text-white mb-4 whitespace-pre-wrap",children:e.content}),U(e)]}),a.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-100 dark:border-gray-700",children:[a.jsxs("div",{className:"flex items-center space-x-6",children:[a.jsxs("button",{onClick:()=>{return a=e.id,void M.mutate(a);var a},className:s("flex items-center space-x-2 transition-colors",e.isLiked?"text-red-500":"text-gray-500 hover:text-red-500"),children:[a.jsx(h,{className:s("w-5 h-5",e.isLiked&&"fill-current")}),a.jsx("span",{className:"text-sm",children:e.likeCount||0})]}),a.jsxs("button",{className:"flex items-center space-x-2 text-gray-500 hover:text-primary-500 transition-colors",children:[a.jsx(g,{className:"w-5 h-5"}),a.jsx("span",{className:"text-sm",children:e.commentCount||0})]}),a.jsxs("button",{onClick:()=>{return a=e.id,void z.mutate(a);var a},className:"flex items-center space-x-2 text-gray-500 hover:text-primary-500 transition-colors",children:[a.jsx(y,{className:"w-5 h-5"}),a.jsx("span",{className:"text-sm",children:e.shareCount||0})]})]}),a.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.platform&&a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700",children:e.platform})})]})]},e.id))})}),I&&a.jsx("div",{className:"text-center mt-8",children:a.jsx("button",{className:"px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Load More Posts"})})]})]})})}function C({friendTab:e,setFriendTab:t,friendSearchQuery:c,setFriendSearchQuery:o}){const x=i(),{data:m,isLoading:p,refetch:h}=n(["friends",e,c],async()=>{if(c.trim()){return{suggestions:(await d.searchUsers(c)).data||[]}}return d.getFriends(e)},{enabled:!0}),g=l(e=>d.sendFriendRequest(e),{onSuccess:()=>{x.invalidateQueries(["friends"])}}),y=l(({friendshipId:e,action:a})=>"accept"===a?d.acceptFriendRequest(e):d.declineFriendRequest(e),{onSuccess:()=>{x.invalidateQueries(["friends"])}}),u=l(e=>d.removeFriend(e),{onSuccess:()=>{x.invalidateQueries(["friends"])}}),j=m?.friends||[],w=m?.pending||[],S=m?.suggestions||[];return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),a.jsx("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:"Search for friends...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:[a.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[a.jsxs("button",{onClick:()=>t("all"),className:s("flex-1 px-6 py-4 text-sm font-medium border-b-2 transition-colors","all"===e?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:["All Friends (",j.length,")"]}),a.jsxs("button",{onClick:()=>t("pending"),className:s("flex-1 px-6 py-4 text-sm font-medium border-b-2 transition-colors","pending"===e?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:["Pending (",w.length,")"]}),a.jsxs("button",{onClick:()=>t("suggestions"),className:s("flex-1 px-6 py-4 text-sm font-medium border-b-2 transition-colors","suggestions"===e?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:["Suggestions (",S.length,")"]})]}),a.jsx("div",{className:"p-6",children:p?a.jsx("div",{className:"flex items-center justify-center py-12",children:a.jsx(r,{size:"lg"})}):a.jsxs("div",{className:"space-y-4",children:["all"===e&&0===j.length&&a.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No friends yet"}),"pending"===e&&0===w.length&&a.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No pending requests"}),"suggestions"===e&&0===S.length&&a.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"No suggestions available"}),"all"===e&&j.map(e=>{const s=e.friend||e.user;return a.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("img",{src:s?.avatar_url||"/placeholder-avatar.jpg",alt:s?.display_name,className:"w-12 h-12 rounded-full object-cover"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:s?.display_name}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s?.email})]})]}),a.jsxs("button",{onClick:()=>u.mutate(e.id),className:"flex items-center space-x-2 px-4 py-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[a.jsx(f,{className:"w-4 h-4"}),a.jsx("span",{children:"Unfriend"})]})]},e.id)}),"pending"===e&&w.map(e=>{const s=e.user||e.friend,r=e.requester_id===e.currentUserId;return a.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("img",{src:s?.avatar_url||"/placeholder-avatar.jpg",alt:s?.display_name,className:"w-12 h-12 rounded-full object-cover"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:s?.display_name}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r?"Request sent":"Wants to be friends"})]})]}),!r&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("button",{onClick:()=>y.mutate({friendshipId:e.id,action:"accept"}),className:"flex items-center space-x-2 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[a.jsx(N,{className:"w-4 h-4"}),a.jsx("span",{children:"Accept"})]}),a.jsxs("button",{onClick:()=>y.mutate({friendshipId:e.id,action:"decline"}),className:"flex items-center space-x-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[a.jsx(v,{className:"w-4 h-4"}),a.jsx("span",{children:"Decline"})]})]})]},e.id)}),"suggestions"===e&&S.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("img",{src:e?.avatar_url||"/placeholder-avatar.jpg",alt:e?.display_name,className:"w-12 h-12 rounded-full object-cover"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:e?.display_name}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e?.email})]})]}),a.jsxs("button",{onClick:()=>g.mutate(e.id),disabled:g.isLoading,className:"flex items-center space-x-2 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-50",children:[a.jsx(k,{className:"w-4 h-4"}),a.jsx("span",{children:"Add Friend"})]})]},e.id))]})})]})]})}function F(){return a.jsx(S,{})}export{F as default};
